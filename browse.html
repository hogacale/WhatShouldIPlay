<!DOCTYPE html>
<html lang="en">

<head>
	<!-- Include bootstrap CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css"
		integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
</head>

<body>
<!--Nav bar-->
<div id="nav-placeholder"></div>
<script>$(function(){$("#nav-placeholder").load("nav.html");});</script>
<!--end of nav bar-->

	<div class="container-fluid">
		<div class="row">
			<div class="col-12">
				<p>Filter games by genre:
					<select onchange="displayGamesInfo()" id="genre">
						<option value="All" selected='selected'>All</option>
						<option value="Action">Action</option>
						<option value="Adventure">Adventure</option>
						<option value="Animation">Animation</option>
						<option value="Casual">Casual</option>
						<option value="Indie">Indie</option>
						<option value="Massively Multiplayer">Massively Multiplayer</option>
						<option value="Racing">Racing</option>
						<option value="RPG">RPG</option>
						<option value="Simulation">Simulation</option>
						<option value="Sports">Sports</option>
						<option value="Strategy">Strategy</option>
					</select>
				</p>
				<p>Filter games by ratings:
					<select onchange="displayGamesInfo()" id="rating">
						<option value="All" selected='selected'>All</option>
						<option value=25>Greater than 25</option>
						<option value=50>Greater than 50</option>
						<option value=100>Greater than 100</option>
					</select>
				</p>
				<table class='table table-bordered'>
					<thead style="font-weight: bold">
						<!-- <th>Game Id</th> -->
						<th>Name</th>
						<th>Publisher</th>
						<th>Average Rating</th>
						<th>Price</th>
						<th>Genre</th>
					</thead>
					<tbody id='gamelist'></tbody>
				</table>
			</div>
		</div>
	</div>
</body>
<script type="text/javascript">
displayGamesInfo()

function displayGamesInfo() {
	const genre = document.getElementById('genre').value;
	//const rating = document.getElementById('rating').value;
	getData(`http://localhost/whatshouldiplay2/gameApi.php?type=browse&genre=${genre}`).then(function(response) {
		const apiResponse = JSON.parse(response)
		if (apiResponse.length > 0) {
			const tRows = prepareHTMLContent(apiResponse);
			document.getElementById('gamelist').innerHTML = tRows;
		}
	});
}

function getData(url) {
	if (url) {
		const task = new Promise( function(resolve, reject) {
		const req = new XMLHttpRequest();
		req.open('GET', url);
		req.send();
		req.onload = function(){
			req.status === 200 ? resolve(req.response) : reject(Error(req.statusText));
		}
		req.onerror = function(e) { reject(Error(`Network Error: ${e}`));} 
		});
		return task;
	}
	return false;
}

function prepareHTMLContent(list) {
	let output = "";
	for(let i in list ) {
	const games = list[i];
		output += `<tr><td>${games.name}</td><td>${games.publisherName}</td><td>${games.averageRatings}</td><td>${games.price}</td><td>${games.genreName}</td></tr>`;
	}
	return output;
}

</script>
</html>